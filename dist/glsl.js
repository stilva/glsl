var GLSL=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){n(t,e,r[e])})}return t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=function(){function e(r,n){var i=n.antialias,a=n.height,o=n.width,s=n.webglVersion;t(this,e),this._canvas=r;try{this._context=r.getContext(s,{antialias:i})}catch(t){throw new Error("Error while getting the context. ".concat(t.message))}r.width=o,r.height=a}return r(e,[{key:"context",get:function(){return this._context}},{key:"node",get:function(){return this._canvas}},{key:"height",get:function(){return this._canvas.height}},{key:"width",get:function(){return this._canvas.width}}]),e}(),s={float:"uniform1f",vec2:"uniform2fv",vec3:"uniform3fv",vec4:"uniform4fv"};function c(t,e,r){var n,i=(n=e,Array.isArray(n)?n:[n]),o=a(function(t,e){if(e)return[e,"[".concat(t.length,"]")];if(1===t.length)return["float",""];return["vec".concat(t.length),""]}(i,r),2),c=o[0],u=o[1],l=s[c];return{name:t,linked:!1,value:i,type:c,size:u,location:"".concat(t,"Location"),locationType:l}}function u(t,e,r){var n,i;return{apply:h,name:t,index:e,pSource:"string"==typeof r?l(r):r instanceof Blob?(n=r,i=new FileReader,new Promise(function(t){i.addEventListener("load",function(e){t(e.target.result)}),i.readAsDataURL(n)})).then(l):Promise.resolve(r),linked:!1}}function l(t){var e=new Image;return e.crossOrigin="Anonymous",new Promise(function(r){e.addEventListener("load",function(t){return r(e)}),e.src=t})}function h(){}var f="webgl2",_=["lowp","mediump","highp"],v=new Set(["webgl",f]);return function(){function e(r,n){if(t(this,e),this._destroyed=!1,this._options=i({antialias:!1,precision:1,webglVersion:f},n),!v.has(this._options.webglVersion))throw new Error("Constructor option is invalid: webglVersion needs to be either ".concat(Array.from(v).join(" or ")));this._canvas=function(t,e){var r=Object.assign({antialias:!1},e);if(t instanceof HTMLCanvasElement){var n=i({},r,{height:t.height,width:t.width});return new o(t,n)}if(Array.isArray(t)){var a=i({},r,{height:t[1],width:t[0]}),s=document.createElement("canvas");return new o(s,a)}throw new Error("getCanvas expects an HTMLCanvasElement or an Array [width, height]")}(r,this._options),this._gl=this._canvas.context,this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight),this._locations={},this._variables={},this._textures={},this._vertex="".concat(this.isWebgl2?"#version 300 es\n    in vec2 a_position;":"attribute vec2 a_position;","\n\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(a_position, 0, 1);\n\t\t}"),this._initTime=Date.now(),this.addVariable("u_time",0),this.resize=this.addVariable("u_resolution",[this._canvas.width,this._canvas.height])}return r(e,[{key:"canvas",get:function(){return this._canvas.node}},{key:"isWebgl2",get:function(){return this._options.webglVersion===f}}]),r(e,[{key:"addVariable",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._variables.hasOwnProperty(t))throw new Error("Variable ".concat(t," has already been added to this instance."));return this._variables[t]=c(t,e,n),function(e){var n=r._variables[t],i=n.location,a=n.locationType;r._variables[t].value=e,r._gl[a](r._locations[i],r._variables[t].value)}}},{key:"addTexture",value:function(t,e){var r=this;if(this._textures.hasOwnProperty(t))throw new Error("Texture ".concat(t," has already been added to this instance."));var n=Object.keys(this._textures).length;return this._textures[t]=u(t,n,e),function(e){r._textures[t].apply(e)}}},{key:"fragment",value:function(t){for(var e=this,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a,o,s=Array.isArray(t)?t:[t];if(n.length!==s.length-1)throw new Error("The fragment shader provided has an invalid amount of arguments");this._fragment="".concat(this.isWebgl2?"#version 300 es":"","\n    precision ").concat(_[this._options.precision]," float;\n\t\t\n\t\t").concat((o=this._variables,Object.keys(o).reduce(function(t,e){return"".concat(t,"\n\t\tuniform ").concat(o[e].type," ").concat(e).concat(o[e].size,";")},"")),"\n\t\t\n\t\t").concat((a=this._textures,Object.keys(a).reduce(function(t,e){return"".concat(t,"\n\t\tuniform sampler2D ").concat(e,";")},"")),"\n\t\t\n\t\t").concat(s.reduce(function(t,e,r){return"".concat(t).concat(n[r]).concat(e)})),this._program=function(t,e,r){var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW);var i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(i));var a=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(a,r),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(a));var o=t.createProgram();t.attachShader(o,i),t.attachShader(o,a),t.linkProgram(o),t.useProgram(o);var s=t.getAttribLocation(o,"a_position");return t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),o}(this._gl,this._vertex,this._fragment),Object.keys(this._variables).forEach(function(t){if(!e._variables[t].linked){var r=e._variables[t],n=r.name,i=r.location,a=r.locationType,o=e._gl.getUniformLocation(e._program,n);e._gl[a](o,e._variables[t].value),e._locations[i]=o,e._variables[t].linked=!0}}),Object.keys(this._textures).forEach(function(t){if(!e._textures[t].linked){var r=e._textures[t],n=r.name,i=r.index,a=r.pSource;e._textures[t].linked=!0;var o=function(t,e,r,n){var i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.uniform1i(t.getUniformLocation(e,n),r);var a=t["TEXTURE".concat(r)];return t.activeTexture(a),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,new ImageData(2,2)),{apply:function(e){t.activeTexture(a),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)},texture:i}}(e._gl,e._program,i+1,n);e._textures[t].apply=o.apply,a.then(function(t){o.apply(t)})}})}},{key:"render",value:function(){var t=this;if(!this._destroyed){this._gl.clear(this._gl.COLOR_BUFFER_BIT),this._gl.drawArrays(this._gl.TRIANGLES,0,6);var e=this._variables.u_time,r=e.locationType,n=e.location;this._gl[r](this._locations[n],(Date.now()-this._initTime)/1e3),requestAnimationFrame(function(e){return t.render()})}}},{key:"kill",value:function(){this._destroyed=!0,this._gl.getExtension("WEBGL_lose_context").loseContext(),this._gl.useProgram(null),this._gl.deleteProgram(this._program)}}]),e}()}();