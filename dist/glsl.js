var GLSL=function(){"use strict";class t{get context(){return this._context}get node(){return this._canvas}get height(){return this._canvas.height}get width(){return this._canvas.width}constructor(t,e){let i=e.width,r=e.height,a=e.antialias;this._canvas=t;try{this._context=t.getContext("webgl",{antialias:a})}catch(t){throw new Error(`Error while getting the context. ${t.message}`)}t.width=i,t.height=r}}const e=["uniform1f","uniform2fv","uniform3fv","uniform4fv"];function i(t,i){const r=(n=i,Array.isArray(n)?n:[n]);var n;const s=r.length-1,o=e[s];return{name:t,linked:!1,value:r,type:a(r),location:`${t}Location`,locationType:o}}function r(t,e,i){return{name:t,index:e,texture:"string"==typeof i?function(t){const e=new Image;return e.crossOrigin="Anonymous",new Promise(i=>{e.addEventListener("load",t=>i(e)),e.src=t})}(i):Promise.resolve(i),linked:!1}}function a(t){return 1==t.length?"float":`vec${t.length}`}const n=["lowp","mediump","highp"];return class{get canvas(){return this._canvas.node}constructor(e,i){this._options=Object.assign({antialias:!1,precision:1},i),this._canvas=function(e,i){const r=Object.assign({antialias:!1},i);if(e instanceof HTMLCanvasElement){const i={width:e.width,height:e.height,antialias:r.antialias};return new t(e,i)}if(Array.isArray(e)){const i={width:e[0],height:e[1],antialias:r.antialias},a=document.createElement("canvas");return new t(a,i)}throw new Error("getCanvas expects an HTMLCanvasElement or an Array [width, height]")}(e,this._options),this._gl=this._canvas.context,this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight),this._locations={},this._variables={},this._textures={},this._vertex="attribute vec2 a_position;\n\t\tvoid main() {\n\t\t\tgl_Position = vec4(a_position, 0, 1);\n\t\t}",this._initTime=Date.now(),this.addVariable("u_time",0),this.addVariable("u_resolution",[this._canvas.width,this._canvas.height])}addVariable(t,e){if(this._variables.hasOwnProperty(t))throw new Error(`Variable ${t} has already been added to this instance.`);return this._variables[t]=i(t,e),e=>{const i=this._variables[t],r=i.location,a=i.locationType;this._variables[t].value=e,this._gl[a](this._locations[r],this._variables[t].value)}}addTexture(t,e){if(this._textures.hasOwnProperty(t))throw new Error(`Texture ${t} has already been added to this instance.`);const i=Object.keys(this._textures).length;this._textures[t]=r(t,i,e)}fragment(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];const a=Array.isArray(t)?t:[t];if(i.length!==a.length-1)throw new Error("The fragment shader provided has an invalid amount of arguments");var s,o;this._fragment=`precision ${n[this._options.precision]} float;\n\t\t\n\t\t${o=this._variables,Object.keys(o).reduce((t,e)=>`${t}\n\t\tuniform ${o[e].type} ${e};`,"")}\n\t\t\n\t\t${s=this._textures,Object.keys(s).reduce((t,e)=>`${t}\n\t\tuniform sampler2D ${e};`,"")}\n\t\t\n\t\t${a.reduce((t,e,r)=>`${t}${i[r]}${e}`)}`,this._program=function(t,e,i){const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW);const a=t.createShader(t.VERTEX_SHADER);t.shaderSource(a,e),t.compileShader(a);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,i),t.compileShader(n);const s=t.createProgram();t.attachShader(s,a),t.attachShader(s,n),t.linkProgram(s),t.useProgram(s);const o=t.getAttribLocation(s,"a_position");return t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),s}(this._gl,this._vertex,this._fragment),Object.keys(this._variables).forEach(t=>{if(this._variables[t].linked)return;const e=this._variables[t],i=e.name,r=e.location,a=e.locationType,n=this._gl.getUniformLocation(this._program,i);this._gl[a](n,this._variables[t].value),this._locations[r]=n,this._variables[t].linked=!0}),Object.keys(this._textures).forEach(t=>{if(this._textures[t].linked)return;const e=this._textures[t],i=e.name,r=e.index,a=e.texture,n=function(t,e,i,r){const a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.uniform1i(t.getUniformLocation(e,r),i);const n=t[`TEXTURE${i}`];return t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,new ImageData(2,2)),{apply:e=>{t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)},texture:a}}(this._gl,this._program,r+1,i);a.then(t=>{n.apply(t)})})}render(){this._gl.clear(this._gl.COLOR_BUFFER_BIT),this._gl.drawArrays(this._gl.TRIANGLES,0,6);let t=this._variables.u_time,e=t.locationType,i=t.location;this._gl[e](this._locations[i],(Date.now()-this._initTime)/1e3),requestAnimationFrame(t=>this.render())}kill(){this._gl.getExtension("WEBGL_lose_context").loseContext(),this._gl.useProgram(null),this._gl.deleteProgram(this._program)}}}();